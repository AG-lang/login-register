# **AI 协作全局规范 (GEMINI.md)**

**最后更新时间:** 2025 年 8 月 1 日

本文件旨在规范与 AI 助手的协作流程，确保开发工作的高效、准确和一致性。

---

## **一、 项目核心原则**

1. **文档优先**:
   - **实时更新**: 在完成任何开发任务（如功能实现、依赖变更、架构调整等）后，**必须** 立即更新 `README.md` 和 `PROJECT_DESIGN.md` 文件。
   - **内容详尽**: 更新内容需清晰记录完成事项、变更原因、当前开发进度、遇到的问题及解决方案等，确保项目文档的完整性和时效性。
2. **环境与依赖管理**:
   - **Python 虚拟环境**: 所有 Python 项目必须在独立的虚拟环境中进行开发和测试，避免全局环境污染。
   - **依赖记录**: 所有项目依赖项必须记录在 `requirements.txt` (后端) 或 `package.json` (前端) 文件中。完成依赖变更后，立即使用 `pip freeze > requirements.txt` 或相应命令更新。
   - **依赖清晰**: `requirements.txt` 文件中应避免使用中文注释，保持内容干净。
3. **代码风格与质量**:
   - **遵循规范**: Python 代码严格遵循 [PEP 8](https://peps.python.org/pep-0008/) 代码风格指南。
   - **自动化工具**: 强烈建议使用 `black` 和 `flake8` 等工具进行代码自动格式化和静态检查，确保代码风格统一和质量。
   - **注释语言**: 所有代码注释统一使用**中文**。

---

## **二、 开发工作流**

1. **端口配置**:
   - **后端**: `40000`
   - **前端**: `10000`
   - **Docker**: `8070`
   - **API 一致性**: 必须确保前后端 API 调用端口始终保持一致。
2. **构建与启动**:
   - **前端**: 执行 `npm run build` 完成构建后，**不要** 自动执行 `npm run dev`。我会手动启动。
   - **后端**: 完成开发和测试后，**不要** 自动启动服务。我会手动启动。
3. **编码与文件处理**:
   - **编码问题**: 处理后端文件时，特别注意 Windows 系统下的中文编码（GBK/UTF-8）问题，确保兼容性。
   - **字符处理**: 在编写测试脚本或处理文本时，主动移除所有 Emoji 及非必要的特殊字符，尽量使用标准的 ASCII 或 UTF-8 字符。
4. **文件管理**:
   - **及时清理**: 定期清理已废弃或无用的文件（如旧的日志、临时脚本等）。
   - **保留归档**: 对于未来可能有用或作为参考的测试文件，应予以保留和适当归档。

---

## **三、 测试与验证**

1. **构建验证**: 在完成前端或后端代码编写后，必须进行构建测试，确保没有编译或打包错误。
2. **端口测试**: 完成服务配置后，进行基本的端口连通性测试，避免因端口问题导致的服务不可用。
3. **数据库迁移**:
   - 当数据库表结构发生变化时，应及时生成和执行迁移脚本。
   - 在必要时（如模型重构），应先删除旧的数据库文件或表，再重新创建，确保数据结构的一致性。

---

## **四、 协作模式**

1. **效率工具**: 优先使用本地 MCP (My Custom Prompt) 等效率工具来简化和加速重复性任务。
2. **复杂问题处理**: 遇到复杂的技术难题或需要选择技术方案时，主动进行网络搜索，参考并采纳**最佳实践** (Best Practices)。
3. **信息真实性**:
   - 提供的所有信息（特别是外部资料和数据）需确保真实有效。
   - 在引用搜索结果时，请标明信息来源（如 URL）。
   - 对于不确定的信息，进行实时查询以保证其准确性和专业性。

---

## **五、 安全与配置管理**

1. **禁止硬编码敏感信息**:（除非显示要求）
   - **严禁** 将任何敏感信息（如数据库密码、API 密钥、私有证书等）直接写入代码。
2. **使用 `.env` 文件**:
   - 所有环境相关的配置和敏感信息都应存储在项目根目录的 `.env` 文件中。
   - 后端项目应使用如 `python-dotenv` 的库来加载这些环境变量。
3. **配置 `.gitignore`**:
   - **必须** 将 `.env` 文件、`__pycache__/` 目录、虚拟环境目录 (`venv/`, `.venv/` 等) 以及其他本地配置文件（如 IDE 配置 `.vscode/`）添加到 `.gitignore` 文件中，确保它们不会被提交到 Git 仓库。

---

## **六、 依赖管理**

1. **定期审查**: 每隔一段时间（如一个月），应审查 `requirements.txt` 和 `package.json` 中的依赖，识别并更新存在安全漏洞或已严重过时的包。
2. **版本锁定**: 为保证环境一致性，建议在 `requirements.txt` 中使用 `==` 来锁定版本号，而不是使用 `>=`。例如 `requests==2.28.1`。
